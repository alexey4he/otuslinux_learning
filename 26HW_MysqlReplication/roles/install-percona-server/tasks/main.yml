---
# tasks file for percona-server
- name: add percona repository
  yum: 
    name: https://repo.percona.com/yum/percona-release-latest.noarch.rpm
    state: present

- name: install percona server
  yum:
    name: Percona-Server-server-57
    state: present

- name: Copy base configuration percona server
  template: 
    src: '{{ item }}'
    dest: /etc/my.cnf.d/{{ item | basename | regex_replace('\.j2','') }}
  with_fileglob: 
    - 'templates/*.j2'
  notify: 
    - Add ignore table slave server 

- name: start percona server for master-host
  systemd: 
    state: started
    name: mysql
    enabled: yes
  notify: 
    - Read default pass for root user mysql
    - update mysql root password


- name: Read default pass for root user mysql
  shell: "cat /var/log/mysqld.log | grep 'root@localhost:' | awk '{print $11}'"
  register: temprootpass

- name: update mysql root password 
  mysql: 
    login_user: root
    login_password: '{{ temprootpass.stdout }}'
    name: root
    password: '{{ rootmysql }}'


- name: check default password
  debug: 
    msg: '{{ temprootpass.stdout }}'

- name: check new password password
  debug: 
    msg: '{{ rootmysql }}'