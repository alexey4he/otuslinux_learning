Script started on Sat 12 May 2018 03:25:20 PM UTC
[vagrant@otuslinux ~]$ sudo lsblk
NAME                    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                       8:0    0   40G  0 disk
├─sda1                    8:1    0    1M  0 part
├─sda2                    8:2    0    1G  0 part /boot
└─sda3                    8:3    0   39G  0 part
  ├─VolGroup00-LogVol00 253:0    0 37.5G  0 lvm  /
  └─VolGroup00-LogVol01 253:1    0  1.5G  0 lvm  [SWAP]
sdb                       8:16   0  250M  0 disk
sdc                       8:32   0  2.5G  0 disk
sdd                       8:48   0  1.5G  0 disk
[vagrant@otuslinux ~]$ suld lvs
  LV       VG         Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  LogVol00 VolGroup00 -wi-ao---- <37.47g
  LogVol01 VolGroup00 -wi-ao----   1.50g
[vagrant@otuslinux ~]$ sudo pvcreate /dev/sd{b,c,d}
  Physical volume "/dev/sdb" successfully created.
  Physical volume "/dev/sdc" successfully created.
  Physical volume "/dev/sdd" successfully created.
vagrant@otuslinux: sudo vgcreate vg0 /dev/sdc /dev/sdb /dev/sdd
vagrant@otuslinux: sudo lvcreate -l 100%FREE -n roottemp vg0
  Logical volume "roottemp" created.
[vagrant@otuslinux ~]$ sudo vgscan
  Reading volume groups from cache.
  Found volume group "VolGroup00" using metadata type lvm2
  Found volume group "vg0" using metadata type lvm2
[vagrant@otuslinux ~]$ sudo vgchange -ay
  2 logical volume(s) in volume group "VolGroup00" now active
  1 logical volume(s) in volume group "vg0" now active
[vagrant@otuslinux ~]$ sudp lvs
  LV       VG         Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  LogVol00 VolGroup00 -wi-ao---- <37.47g
  LogVol01 VolGroup00 -wi-ao----   1.50g
  roottemp vg0        -wi-a-----   4.14g
[vagrant@otuslinux ~]$ sudo mkfs
mkfs         mkfs.cramfs  mkfs.ext3    mkfs.minix
mkfs.btrfs   mkfs.ext2    mkfs.ext4    mkfs.xfs
[vagrant@otuslinux ~]$ sudo mkfs.xfs /dev/vg0/roottemp
meta-data=/dev/vg0/roottemp      isize=512    agcount=4, agsize=271360 blks
         =                       sectsz=512   attr=2, projid32bit=1
         =                       crc=1        finobt=0, sparse=0
data     =                       bsize=4096   blocks=1085440, imaxpct=25
         =                       sunit=0      swidth=0 blks
naming   =version 2              bsize=4096   ascii-ci=0 ftype=1
log      =internal log           bsize=4096   blocks=2560, version=2
         =                       sectsz=512   sunit=0 blks, lazy-count=1
realtime =none                   extsz=4096   blocks=0, rtextents=0

[vagrant@otuslinux ~]$ sudo mount /dev/mapper/vg0-roottemp /mnt/
[vagrant@otuslinux ~]$ sudo dnf install xfsdump
Loaded plugins: fastestmirror
Loading mirror speeds from cached hostfile
 * base: centos-mirror.rbc.ru
 * extras: dedic.sh
 * updates: centos-mirror.rbc.ru
Resolving Dependencies
--> Running transaction check
---> Package xfsdump.x86_64 0:3.1.7-1.el7 will be installed
--> Processing Dependency: attr >= 2.0.0 for package: xfsdump-3.1.7-1.el7.x86_64
--> Running transaction check
---> Package attr.x86_64 0:2.4.46-13.el7 will be installed
--> Processing Dependency: libattr = 2.4.46-13.el7 for package: attr-2.4.46-13.el7.x86_64
--> Running transaction check
---> Package libattr.x86_64 0:2.4.46-12.el7 will be updated
---> Package libattr.x86_64 0:2.4.46-13.el7 will be an update
--> Finished Dependency Resolution

Dependencies Resolved

================================================================================
 Package          Arch            Version                   Repository     Size
================================================================================
Installing:
 xfsdump          x86_64          3.1.7-1.el7               base          308 k
Installing for dependencies:
 attr             x86_64          2.4.46-13.el7             base           66 k
Updating for dependencies:
 libattr          x86_64          2.4.46-13.el7             base           18 k

Transaction Summary
================================================================================
Install  1 Package  (+1 Dependent package)
Upgrade             ( 1 Dependent package)

Total download size: 392 k
Is this ok [y/d/N]: y
Downloading packages:
No Presto metadata available for base
(1/3): libattr-2.4.46-13.el7.x86_64.rpm                    |  18 kB   00:00
(2/3): attr-2.4.46-13.el7.x86_64.rpm                       |  66 kB   00:00
(3/3): xfsdump-3.1.7-1.el7.x86_64.rpm                      | 308 kB   00:00
--------------------------------------------------------------------------------
Total                                              1.2 MB/s | 392 kB  00:00
Running transaction check
Running transaction test
Transaction test succeeded
Running transaction
  Updating   : libattr-2.4.46-13.el7.x86_64 [                             ] 1/4  Updating   : libattr-2.4.46-13.el7.x86_64 [############################ ] 1/4  Updating   : libattr-2.4.46-13.el7.x86_64                                 1/4
  Installing : attr-2.4.46-13.el7.x86_64 [                                ] 2/4  Installing : attr-2.4.46-13.el7.x86_64 [#                               ] 2/4  Installing : attr-2.4.46-13.el7.x86_64 [#####                           ] 2/4  Installing : attr-2.4.46-13.el7.x86_64 [########                        ] 2/4  Installing : attr-2.4.46-13.el7.x86_64 [#########                       ] 2/4  Installing : attr-2.4.46-13.el7.x86_64 [############                    ] 2/4  Installing : attr-2.4.46-13.el7.x86_64 [#############                   ] 2/4  Installing : attr-2.4.46-13.el7.x86_64 [################                ] 2/4  Installing : attr-2.4.46-13.el7.x86_64 [####################            ] 2/4  Installing : attr-2.4.46-13.el7.x86_64 [#####################           ] 2/4  Installing : attr-2.4.46-13.el7.x86_64 [######################          ] 2/4  Installing : attr-2.4.46-13.el7.x86_64 [#######################         ] 2/4  Installing : attr-2.4.46-13.el7.x86_64 [########################        ] 2/4  Installing : attr-2.4.46-13.el7.x86_64 [#########################       ] 2/4  Installing : attr-2.4.46-13.el7.x86_64 [##########################      ] 2/4  Installing : attr-2.4.46-13.el7.x86_64 [###########################     ] 2/4  Installing : attr-2.4.46-13.el7.x86_64 [#############################   ] 2/4  Installing : attr-2.4.46-13.el7.x86_64 [##############################  ] 2/4  Installing : attr-2.4.46-13.el7.x86_64 [############################### ] 2/4  Installing : attr-2.4.46-13.el7.x86_64                                    2/4
  Installing : xfsdump-3.1.7-1.el7.x86_64 [                               ] 3/4  Installing : xfsdump-3.1.7-1.el7.x86_64 [#                              ] 3/4  Installing : xfsdump-3.1.7-1.el7.x86_64 [####                           ] 3/4  Installing : xfsdump-3.1.7-1.el7.x86_64 [######                         ] 3/4  Installing : xfsdump-3.1.7-1.el7.x86_64 [########                       ] 3/4  Installing : xfsdump-3.1.7-1.el7.x86_64 [#########                      ] 3/4  Installing : xfsdump-3.1.7-1.el7.x86_64 [###########                    ] 3/4  Installing : xfsdump-3.1.7-1.el7.x86_64 [#############                  ] 3/4  Installing : xfsdump-3.1.7-1.el7.x86_64 [###############                ] 3/4  Installing : xfsdump-3.1.7-1.el7.x86_64 [#################              ] 3/4  Installing : xfsdump-3.1.7-1.el7.x86_64 [###################            ] 3/4  Installing : xfsdump-3.1.7-1.el7.x86_64 [#####################          ] 3/4  Installing : xfsdump-3.1.7-1.el7.x86_64 [######################         ] 3/4  Installing : xfsdump-3.1.7-1.el7.x86_64 [#######################        ] 3/4  Installing : xfsdump-3.1.7-1.el7.x86_64 [########################       ] 3/4  Installing : xfsdump-3.1.7-1.el7.x86_64 [##########################     ] 3/4  Installing : xfsdump-3.1.7-1.el7.x86_64 [###########################    ] 3/4  Installing : xfsdump-3.1.7-1.el7.x86_64 [#############################  ] 3/4  Installing : xfsdump-3.1.7-1.el7.x86_64 [############################## ] 3/4  Installing : xfsdump-3.1.7-1.el7.x86_64                                   3/4
  Cleanup    : libattr-2.4.46-12.el7.x86_64                                 4/4
  Verifying  : attr-2.4.46-13.el7.x86_64                                    1/4
  Verifying  : xfsdump-3.1.7-1.el7.x86_64                                   2/4
  Verifying  : libattr-2.4.46-13.el7.x86_64                                 3/4
  Verifying  : libattr-2.4.46-12.el7.x86_64                                 4/4

Installed:
  xfsdump.x86_64 0:3.1.7-1.el7

Dependency Installed:
  attr.x86_64 0:2.4.46-13.el7

Dependency Updated:
  libattr.x86_64 0:2.4.46-13.el7

Complete!
[vagrant@otuslinux ~]$ sudo xfsdump -f /tmp/rootdump /dev/mapper/VolGroup00-LogVol00
xfsdump: using file dump (drive_simple) strategy
xfsdump: version 3.1.7 (dump format 3.0) - type ^C for status and control

 ============================= dump label dialog ==============================

please enter label for this dump session (timeout in 300 sec)
 -> full
session label entered: "full"

 --------------------------------- end dialog ---------------------------------

xfsdump: level 0 dump of otuslinux:/
xfsdump: dump date: Sun May 13 08:41:25 2018
xfsdump: session id: 234d1436-90b3-49f8-8a66-90bb1f10e3f8
xfsdump: session label: "full"
xfsdump: ino map phase 1: constructing initial dump list
xfsdump: ino map phase 2: skipping (no pruning necessary)
xfsdump: ino map phase 3: skipping (only one dump stream)
xfsdump: ino map construction complete
xfsdump: estimated dump size: 684012864 bytes

 ============================= media label dialog =============================

please enter label for media in drive 0 (timeout in 300 sec)
 -> 0
media label entered: "0"

 --------------------------------- end dialog ---------------------------------

xfsdump: creating dump session media file 0 (media 0, file 0)
xfsdump: dumping ino map
xfsdump: dumping directories
xfsdump: dumping non-directory files
xfsdump: ending media file
xfsdump: media file size 1013819648 bytes
xfsdump: dump size (non-dir files) : 1000890416 bytes
xfsdump: dump complete: 9 seconds elapsed
xfsdump: Dump Summary:
xfsdump:   stream 0 /tmp/rootdump OK (success)
xfsdump: Dump Status: SUCCESS
[vagrant@otuslinux ~]$ sudo mount /dev/mapper/vg0-roottemp /mnt/
[vagrant@otuslinux ~]$ sudo xfsrestore -f /tmp/rootdump /mnt/
xfsrestore: using file dump (drive_simple) strategy
xfsrestore: version 3.1.7 (dump format 3.0) - type ^C for status and control
xfsrestore: searching media for dump
xfsrestore: examining media file 0
xfsrestore: dump description:
xfsrestore: hostname: otuslinux
xfsrestore: mount point: /
xfsrestore: volume: /dev/mapper/VolGroup00-LogVol00
xfsrestore: session time: Sun May 13 08:41:25 2018
xfsrestore: level: 0
xfsrestore: session label: "full"
xfsrestore: media label: "0"
xfsrestore: file system id: fca2ab64-5588-4787-89bc-03642ce7ccca
xfsrestore: session id: 234d1436-90b3-49f8-8a66-90bb1f10e3f8
xfsrestore: media id: f9183448-75f3-4773-a1af-ff72360d19b8
xfsrestore: using online session inventory
xfsrestore: searching media for directory dump
xfsrestore: reading directories
xfsrestore: 2650 directories and 23242 entries processed
xfsrestore: directory post-processing
xfsrestore: restoring non-directory files
xfsrestore: restore complete: 6 seconds elapsed
xfsrestore: Restore Summary:
xfsrestore:   stream 0 /tmp/rootdump OK (success)
xfsrestore: Restore Status: SUCCESS


[vagrant@otuslinux ~]$ sudo lsblk
NAME                    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                       8:0    0   40G  0 disk
├─sda1                    8:1    0    1M  0 part
├─sda2                    8:2    0    1G  0 part /boot
└─sda3                    8:3    0   39G  0 part
  ├─VolGroup00-LogVol01 253:1    0  1.5G  0 lvm  [SWAP]
  └─VolGroup00-LogVol00 253:2    0 37.5G  0 lvm
sdb                       8:16   0  250M  0 disk
└─vg0-roottemp          253:0    0  4.1G  0 lvm  /
sdc                       8:32   0  2.5G  0 disk
└─vg0-roottemp          253:0    0  4.1G  0 lvm  /
sdd                       8:48   0  1.5G  0 disk
└─vg0-roottemp          253:0    0  4.1G  0 lvm  /

[vagrant@otuslinux ~]$ sudo lvremove /dev/VolGroup00/LogVol00
Do you really want to remove active logical volume VolGroup00/LogVol00? [y/n]: y
  Logical volume "LogVol00" successfully removed

[vagrant@otuslinux ~]$ sudo lvcreate -L 8G -n root VolGroup00
WARNING: xfs signature detected on /dev/VolGroup00/root at offset 0. Wipe it? [y/n]: y
  Wiping xfs signature on /dev/VolGroup00/root.
  Logical volume "root" created.
[vagrant@otuslinux ~]$ sudo lvcreate -L 8G -n home VolGroup00
  Logical volume "home" created.
[vagrant@otuslinux ~]$ sudo lvcreate -L 8G -n var VolGroup00
  Logical volume "var" created.

[vagrant@otuslinux ~]$ sudo mkfs.xfs /dev/mapper/VolGroup00-root
meta-data=/dev/mapper/VolGroup00-root isize=512    agcount=4, agsize=524288 blks
         =                       sectsz=512   attr=2, projid32bit=1
         =                       crc=1        finobt=0, sparse=0
data     =                       bsize=4096   blocks=2097152, imaxpct=25
         =                       sunit=0      swidth=0 blks
naming   =version 2              bsize=4096   ascii-ci=0 ftype=1
log      =internal log           bsize=4096   blocks=2560, version=2
         =                       sectsz=512   sunit=0 blks, lazy-count=1
realtime =none                   extsz=4096   blocks=0, rtextents=0


[vagrant@otuslinux ~]$ sudo vgscan
  Reading volume groups from cache.
  Found volume group "VolGroup00" using metadata type lvm2
  Found volume group "vg0" using metadata type lvm2
[vagrant@otuslinux ~]$ sudo vgchange -ay
  4 logical volume(s) in volume group "VolGroup00" now active
  1 logical volume(s) in volume group "vg0" now active

[vagrant@otuslinux ~]$ sudo xfsdump -f /tmp/rootdump /dev/vg0/roottemp
xfsdump: using file dump (drive_simple) strategy
xfsdump: version 3.1.7 (dump format 3.0) - type ^C for status and control
   ============================= dump label dialog ==============================
  please enter label for this dump session (timeout in 300 sec)
 -> full
session label entered: "full"
 --------------------------------- end dialog ---------------------------------
xfsdump: level 0 dump of otuslinux:/
xfsdump: dump date: Sun May 13 09:04:21 2018
xfsdump: session id: 97e6948d-06c9-4e8d-9f35-21ceb31572ad
xfsdump: session label: "full"
xfsdump: ino map phase 1: constructing initial dump list
xfsdump: ino map phase 2: skipping (no pruning necessary)
xfsdump: ino map phase 3: skipping (only one dump stream)
xfsdump: ino map construction complete
xfsdump: estimated dump size: 682653952 bytes
xfsdump: /var/lib/xfsdump/inventory created
 ============================= media label dialog =============================
  please enter label for media in drive 0 (timeout in 300 sec)
 -> 0
  media label entered: "0"
--------------------------------- end dialog ---------------------------------
xfsdump: creating dump session media file 0 (media 0, file 0)
xfsdump: dumping ino map
xfsdump: dumping directories
xfsdump: dumping non-directory files

xfsdump: ending media file
xfsdump: media file size 940796552 bytes
xfsdump: dump size (non-dir files) : 927863440 bytes
xfsdump: dump complete: 17 seconds elapsed
xfsdump: Dump Summary:
xfsdump:   stream 0 /tmp/rootdump OK (success)
xfsdump: Dump Status: SUCCESS

[vagrant@otuslinux ~]$ sudo mount /dev/VolGroup00/root /mnt/

[vagrant@otuslinux ~]$ sudo xfsrestore -f /tmp/rootdump /mnt/
xfsrestore: using file dump (drive_simple) strategy
xfsrestore: version 3.1.7 (dump format 3.0) - type ^C for status and control
xfsrestore: searching media for dump
xfsrestore: examining media file 0
xfsrestore: dump description:
xfsrestore: hostname: otuslinux
xfsrestore: mount point: /
xfsrestore: volume: /dev/mapper/vg0-roottemp
xfsrestore: session time: Sun May 13 09:04:21 2018
xfsrestore: level: 0
xfsrestore: session label: "full"
xfsrestore: media label: "0"
xfsrestore: file system id: 8349da0b-ee6e-4065-92d2-ad4a62223883
xfsrestore: session id: 97e6948d-06c9-4e8d-9f35-21ceb31572ad
xfsrestore: media id: e269b81a-bea5-4ecb-a663-2348058ab13e
xfsrestore: using online session inventory
xfsrestore: searching media for directory dump
xfsrestore: reading directories
xfsrestore: 2654 directories and 23249 entries processed
xfsrestore: directory post-processing
xfsrestore: restoring non-directory files
xfsrestore: restore complete: 4 seconds elapsed
xfsrestore: Restore Summary:
xfsrestore:   stream 0 /tmp/rootdump OK (success)
xfsrestore: Restore Status: SUCCESS

linux16 /vmlinuz-3.10.0-693.21.1.el7.x86_64 root=/dev/mapper/VolGroup00-root ro no_timer_check console=tty0 console=ttyS0,115200n8 net.ifnames=0 biosdevname=0 crashkernel=auto rd.lvm.lv=VolGroup00/root rd.lvm.lv=VolGroup00/LogVol01 rhgb quiet
/dev/mapper/VolGroup00-root     /                       xfs     defaults        0 0

[vagrant@otuslinux tmp]$ sudo mkdir /tmp/home
[vagrant@otuslinux tmp]$ sudo cp -ra /home/* /tmp/home/

[vagrant@otuslinux /]$ sudo mkfs.ext4 /dev/mapper/VolGroup00-home
mke2fs 1.42.9 (28-Dec-2013)
Filesystem label=
OS type: Linux
Block size=4096 (log=2)
Fragment size=4096 (log=2)
Stride=0 blocks, Stripe width=0 blocks
524288 inodes, 2097152 blocks
104857 blocks (5.00%) reserved for the super user
First data block=0
Maximum filesystem blocks=2147483648
64 block groups
32768 blocks per group, 32768 fragments per group
8192 inodes per group
Superblock backups stored on blocks:
	32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632

Allocating group tables: done
Writing inode tables: done
Creating journal (32768 blocks): done
Writing superblocks and filesystem accounting information: done

[vagrant@otuslinux /]$ sudo mount /dev/mapper/VolGroup00-home /home
[vagrant@otuslinux /]$ sudp cp -ra /tmp/home/* /home/
[vagrant@otuslinux /]$ lsblk
NAME                    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                       8:0    0  250M  0 disk
└─vg0-roottemp          253:2    0  4.1G  0 lvm
sdb                       8:16   0  2.5G  0 disk
└─vg0-roottemp          253:2    0  4.1G  0 lvm
sdc                       8:32   0  1.5G  0 disk
└─vg0-roottemp          253:2    0  4.1G  0 lvm
sdd                       8:48   0   40G  0 disk
├─sdd1                    8:49   0    1M  0 part
├─sdd2                    8:50   0    1G  0 part /boot
└─sdd3                    8:51   0   39G  0 part
  ├─VolGroup00-root     253:0    0    8G  0 lvm  /
  ├─VolGroup00-LogVol01 253:1    0  1.5G  0 lvm  [SWAP]
  ├─VolGroup00-home     253:3    0    8G  0 lvm  /home
  └─VolGroup00-var      253:4    0    8G  0 lvm
[vagrant@otuslinux /]$ sudo rm -rf /tmp/home
[vagrant@otuslinux /]$ sudo mkdir  /tmp/var
[vagrant@otuslinux /]$ sudo cp -ra /var/* /tmp/va
vagrant-shell  var/
[vagrant@otuslinux /]$ sudo cp -ra /var/* /tmp/var/
[vagrant@otuslinux /]$ sudo mount /dev/mapper/VolGroup00-var /var
[vagrant@otuslinux /]$ lsblk
NAME                    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                       8:0    0  250M  0 disk
└─vg0-roottemp          253:2    0  4.1G  0 lvm
sdb                       8:16   0  2.5G  0 disk
└─vg0-roottemp          253:2    0  4.1G  0 lvm
sdc                       8:32   0  1.5G  0 disk
└─vg0-roottemp          253:2    0  4.1G  0 lvm
sdd                       8:48   0   40G  0 disk
├─sdd1                    8:49   0    1M  0 part
├─sdd2                    8:50   0    1G  0 part /boot
└─sdd3                    8:51   0   39G  0 part
  ├─VolGroup00-root     253:0    0    8G  0 lvm  /
  ├─VolGroup00-LogVol01 253:1    0  1.5G  0 lvm  [SWAP]
  ├─VolGroup00-home     253:3    0    8G  0 lvm  /home
  └─VolGroup00-var      253:4    0    8G  0 lvm  /var
[vagrant@otuslinux /]$ sudo cp -ra /tmp/var/* /var/
[vagrant@otuslinux /]$ sudo rm -rf /tmp/var
#
# /etc/fstab
# Created by anaconda on Tue Apr  3 21:42:15 2018
#
# Accessible filesystems, by reference, are maintained under '/dev/disk'
# See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info
#
/dev/mapper/VolGroup00-root     /                       xfs     defaults        0 0
/dev/mapper/VolGroup00-home     /home                   ext4    defaults        0 0
/dev/mapper/VolGroup00-var      /var                    ext4    defaults        0 0
#/dev/mapper/VolGroup00-LogVol00 /                       xfs     defaults        0 0
UUID=a9953552-87ca-4e1c-972e-fb484ce749fe /boot                   xfs     defaults        0 0
/dev/mapper/VolGroup00-LogVol01 swap                    swap    defaults        0 0


[vagrant@otuslinux ~]$ sudo lvcreate -L 5G -s -n snap_home /dev/mapper/VolGroup00-home
  Using default stripesize 64.00 KiB.
  Logical volume "snap_home" created.
[vagrant@otuslinux ~]$ sudo lsblk -l
NAME                     MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                        8:0    0   40G  0 disk
sda1                       8:1    0    1M  0 part
sda2                       8:2    0    1G  0 part /boot
sda3                       8:3    0   39G  0 part
VolGroup00-root          253:0    0    8G  0 lvm  /
VolGroup00-LogVol01      253:1    0  1.5G  0 lvm  [SWAP]
VolGroup00-var           253:4    0    8G  0 lvm  /var
VolGroup00-home-real     253:5    0    8G  0 lvm
VolGroup00-home          253:3    0    8G  0 lvm  /home
VolGroup00-snap_home     253:7    0    8G  0 lvm
VolGroup00-snap_home-cow 253:6    0    5G  0 lvm
VolGroup00-snap_home     253:7    0    8G  0 lvm
sdb                        8:16   0  250M  0 disk
vg0-roottemp             253:2    0  4.1G  0 lvm
sdc                        8:32   0  2.5G  0 disk
vg0-roottemp             253:2    0  4.1G  0 lvm
sdd                        8:48   0  1.5G  0 disk
vg0-roottemp             253:2    0  4.1G  0 lvm

#!/bin/bash
for i in {1..20};
        do dd if=/dev/urandom bs=1024 count=10 of=f$i;
done
~
~
[vagrant@otuslinux ~]$ ls -l
total 256
-rwxrwxr-x. 1 vagrant vagrant    83 May 13 09:52 createf.sh
-rw-rw-r--. 1 vagrant vagrant 10240 May 13 09:52 f
-rw-rw-r--. 1 vagrant vagrant 10240 May 13 09:52 f1
-rw-rw-r--. 1 vagrant vagrant 10240 May 13 09:52 f10
-rw-rw-r--. 1 vagrant vagrant 10240 May 13 09:52 f11
-rw-rw-r--. 1 vagrant vagrant 10240 May 13 09:52 f12
-rw-rw-r--. 1 vagrant vagrant 10240 May 13 09:52 f13
-rw-rw-r--. 1 vagrant vagrant 10240 May 13 09:52 f14
-rw-rw-r--. 1 vagrant vagrant 10240 May 13 09:52 f15
-rw-rw-r--. 1 vagrant vagrant 10240 May 13 09:52 f16
-rw-rw-r--. 1 vagrant vagrant 10240 May 13 09:52 f17
-rw-rw-r--. 1 vagrant vagrant 10240 May 13 09:52 f18
-rw-rw-r--. 1 vagrant vagrant 10240 May 13 09:52 f19
-rw-rw-r--. 1 vagrant vagrant 10240 May 13 09:52 f2
-rw-rw-r--. 1 vagrant vagrant 10240 May 13 09:52 f20
-rw-rw-r--. 1 vagrant vagrant 10240 May 13 09:52 f3
-rw-rw-r--. 1 vagrant vagrant 10240 May 13 09:52 f4
-rw-rw-r--. 1 vagrant vagrant 10240 May 13 09:52 f5
-rw-rw-r--. 1 vagrant vagrant 10240 May 13 09:52 f6
-rw-rw-r--. 1 vagrant vagrant 10240 May 13 09:52 f7
-rw-rw-r--. 1 vagrant vagrant 10240 May 13 09:52 f8
-rw-rw-r--. 1 vagrant vagrant 10240 May 13 09:52 f9

[vagrant@otuslinux ~]$ sudo lvcreate -L 1G -s -n snap_home /dev/VolGroup00/home
  Using default stripesize 64.00 KiB.
  Logical volume "snap_home" created.

[vagrant@otuslinux ~]$ lsblk
NAME                         MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                            8:0    0   40G  0 disk
├─sda1                         8:1    0    1M  0 part
├─sda2                         8:2    0    1G  0 part /boot
└─sda3                         8:3    0   39G  0 part
  ├─VolGroup00-root          253:0    0    8G  0 lvm  /
  ├─VolGroup00-LogVol01      253:1    0  1.5G  0 lvm  [SWAP]
  ├─VolGroup00-var           253:4    0    8G  0 lvm  /var
  ├─VolGroup00-home-real     253:5    0    8G  0 lvm
  │ ├─VolGroup00-home        253:3    0    8G  0 lvm  /home
  │ └─VolGroup00-snap_home   253:7    0    8G  0 lvm
  └─VolGroup00-snap_home-cow 253:6    0    1G  0 lvm
    └─VolGroup00-snap_home   253:7    0    8G  0 lvm
sdb                            8:16   0  250M  0 disk
└─vg0-roottemp               253:2    0  4.1G  0 lvm
sdc                            8:32   0  2.5G  0 disk
└─vg0-roottemp               253:2    0  4.1G  0 lvm
sdd                            8:48   0  1.5G  0 disk
└─vg0-roottemp               253:2    0  4.1G  0 lvm
[vagrant@otuslinux ~]$ sudo ls -l /dev/VolGroup00/
total 0
lrwxrwxrwx. 1 root root 7 May 13 09:53 home -> ../dm-3
lrwxrwxrwx. 1 root root 7 May 13 09:37 LogVol01 -> ../dm-1
lrwxrwxrwx. 1 root root 7 May 13 09:37 root -> ../dm-0
lrwxrwxrwx. 1 root root 7 May 13 09:53 snap_home -> ../dm-7
lrwxrwxrwx. 1 root root 7 May 13 09:37 var -> ../dm-4


[vagrant@otuslinux ~]$ rm -rf f{1..10}
[vagrant@otuslinux ~]$ ls -l
total 136
-rwxrwxr-x. 1 vagrant vagrant    83 May 13 09:52 createf.sh
-rw-rw-r--. 1 vagrant vagrant 10240 May 13 09:52 f
-rw-rw-r--. 1 vagrant vagrant 10240 May 13 09:52 f11
-rw-rw-r--. 1 vagrant vagrant 10240 May 13 09:52 f12
-rw-rw-r--. 1 vagrant vagrant 10240 May 13 09:52 f13
-rw-rw-r--. 1 vagrant vagrant 10240 May 13 09:52 f14
-rw-rw-r--. 1 vagrant vagrant 10240 May 13 09:52 f15
-rw-rw-r--. 1 vagrant vagrant 10240 May 13 09:52 f16
-rw-rw-r--. 1 vagrant vagrant 10240 May 13 09:52 f17
-rw-rw-r--. 1 vagrant vagrant 10240 May 13 09:52 f18
-rw-rw-r--. 1 vagrant vagrant 10240 May 13 09:52 f19
-rw-rw-r--. 1 vagrant vagrant 10240 May 13 09:52 f20


[vagrant@otuslinux /]$ sudo umount /home
umount: /home: target is busy.
        (In some cases useful info about processes that use
         the device is found by lsof(8) or fuser(1))
[vagrant@otuslinux /]$ sudo lsof /home
sudo: lsof: command not found
[vagrant@otuslinux /]$ sudo yum install lsof
Loaded plugins: fastestmirror
Loading mirror speeds from cached hostfile
 * base: mirror.corbina.net
 * extras: mirror.reconn.ru
 * updates: mirror.corbina.net
Resolving Dependencies
--> Running transaction check
---> Package lsof.x86_64 0:4.87-5.el7 will be installed
--> Finished Dependency Resolution

Dependencies Resolved

===================================================================================================================================================================================================================
 Package                                          Arch                                               Version                                                Repository                                        Size
===================================================================================================================================================================================================================
Installing:
 lsof                                             x86_64                                             4.87-5.el7                                             base                                             331 k

Transaction Summary
===================================================================================================================================================================================================================
Install  1 Package

Total download size: 331 k
Installed size: 927 k
Is this ok [y/d/N]: y
Downloading packages:
lsof-4.87-5.el7.x86_64.rpm                                                                                                                                                                  | 331 kB  00:00:00
Running transaction check
Running transaction test
Transaction test succeeded
Running transaction
  Installing : lsof-4.87-5.el7.x86_64                                                                                                                                                                          1/1
  Verifying  : lsof-4.87-5.el7.x86_64                                                                                                                                                                          1/1

Installed:
  lsof.x86_64 0:4.87-5.el7

Complete!
[vagrant@otuslinux /]$ sudo lsof /home
COMMAND  PID    USER   FD   TYPE DEVICE SIZE/OFF   NODE NAME
vi      1472 vagrant  cwd    DIR  253,3     4096 393217 /home/vagrant
vi      1472 vagrant    4u   REG  253,3     4096 393225 /home/vagrant/.createf.sh.swp
[vagrant@otuslinux /]$ sudo kill -9 1472
[1]+  Killed                  vi createf.sh  (wd: ~)
(wd now: /)
[vagrant@otuslinux /]$ sudo lsof /home
[vagrant@otuslinux /]$ sudo umount /home
[vagrant@otuslinux /]$ sudo lvconvert --merge /dev/VolGroup00/snap_home
  Merging of volume VolGroup00/snap_home started.
  home: Merged: 99.99%

  home: Merged: 100.00%
[vagrant@otuslinux /]$
[vagrant@otuslinux /]$ sudo mount /dev/VolGroup00/home /home
[vagrant@otuslinux /]$ cd /home/
[vagrant@otuslinux home]$ ls -l
total 20
drwx------. 2 root    root    16384 May 13 09:20 lost+found
drwx------. 3 vagrant vagrant  4096 May 13 09:53 vagrant
[vagrant@otuslinux home]$ cd vagrant/
[vagrant@otuslinux ~]$ ls -l
total 256
-rwxrwxr-x. 1 vagrant vagrant    83 May 13 09:52 createf.sh
-rw-rw-r--. 1 vagrant vagrant 10240 May 13 09:52 f
-rw-rw-r--. 1 vagrant vagrant 10240 May 13 09:53 f1
-rw-rw-r--. 1 vagrant vagrant 10240 May 13 09:53 f10
-rw-rw-r--. 1 vagrant vagrant 10240 May 13 09:53 f11
-rw-rw-r--. 1 vagrant vagrant 10240 May 13 09:53 f12
-rw-rw-r--. 1 vagrant vagrant 10240 May 13 09:53 f13
-rw-rw-r--. 1 vagrant vagrant 10240 May 13 09:53 f14
-rw-rw-r--. 1 vagrant vagrant 10240 May 13 09:53 f15
-rw-rw-r--. 1 vagrant vagrant 10240 May 13 09:53 f16
-rw-rw-r--. 1 vagrant vagrant 10240 May 13 09:53 f17
-rw-rw-r--. 1 vagrant vagrant 10240 May 13 09:53 f18
-rw-rw-r--. 1 vagrant vagrant 10240 May 13 09:53 f19
-rw-rw-r--. 1 vagrant vagrant 10240 May 13 09:53 f2
-rw-rw-r--. 1 vagrant vagrant 10240 May 13 09:53 f20
-rw-rw-r--. 1 vagrant vagrant 10240 May 13 09:53 f3
-rw-rw-r--. 1 vagrant vagrant 10240 May 13 09:53 f4
-rw-rw-r--. 1 vagrant vagrant 10240 May 13 09:53 f5
-rw-rw-r--. 1 vagrant vagrant 10240 May 13 09:53 f6
-rw-rw-r--. 1 vagrant vagrant 10240 May 13 09:53 f7
-rw-rw-r--. 1 vagrant vagrant 10240 May 13 09:53 f8
-rw-rw-r--. 1 vagrant vagrant 10240 May 13 09:53 f9
